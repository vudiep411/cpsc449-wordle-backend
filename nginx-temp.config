upstream backend {
	# ip_hash;
	server tuffix-vm:5000 weight=1;
	server tuffix-vm:5001 weight=1;
	server tuffix-vm:5002 weight=1;
}

upstream userbackend {
	server 127.0.0.1:5100;
}

server {
      	listen 80;
      	listen [::]:80;

      	server_name tuffix-vm;

      	location / {
		        proxy_pass "http://backend/";
		        #auth_request /auth;
      	}

#	location /user {
#		auth_request /auth;
#		proxy_pass http://backend/user;
#	}

     	location /game {
        auth_request /auth;
        proxy_pass http://backend/game;
      }	

     	location /auth {
          internal;
          proxy_pass http://userbackend/user;
          proxy_pass_request_body off;
          proxy_set_header        Content-Length "";
          proxy_set_header        X-Original-URI $request_uri;
      }
}
